name: Build WSA Variants

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - arch: x64
            gapps: mindthegapps
            winver: 10
          - arch: x64
            gapps: mindthegapps
            winver: 11
          - arch: x64
            gapps: none
            winver: 10
          - arch: x64
            gapps: none
            winver: 11

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Prepare environment
        run: |
          sudo apt update
          sudo apt install -y git wget unzip p7zip-full python3 python3-pip aria2

      - name: Build WSA
        run: |
          echo "==== Building WSA ===="
          bash scripts/run.sh \
            --arch ${{ matrix.arch }} \
            --release-type retail \
            --gapps-variant ${{ matrix.gapps }} \
            --root-sol none \
            --windows-version ${{ matrix.winver }} \
            --compress-format 7z

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: WSA_${{ matrix.arch }}_${{ matrix.gapps }}_Win${{ matrix.winver }}
          path: output/*.7z
