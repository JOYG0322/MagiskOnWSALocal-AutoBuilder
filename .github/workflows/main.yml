name: Build WSA (Magisk + GApps)

on:
  workflow_dispatch:
    inputs:
      MagiskVersion:
        description: 'Magisk version'
        required: false
        default: '27.0'
      RootSolution:
        description: 'Root solution (Magisk / KernelSU / None)'
        required: false
        default: 'Magisk'
      GApps:
        description: 'GApps variant (MindTheGapps / OpenGApps / None)'
        required: false
        default: 'MindTheGapps'
      RemoveAmazon:
        description: 'Remove Amazon Appstore'
        required: false
        default: 'true'
      Architecture:
        description: 'Architecture (x64 / arm64)'
        required: false
        default: 'x64'
      WindowsEdition:
        description: 'Target Windows edition (10 / 11)'
        required: false
        default: '10'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Prepare environment
        run: |
          sudo apt update
          sudo apt install -y git wget unzip python3 python3-pip p7zip-full aria2

      - name: Build WSA package
        run: |
          bash run.sh \
            --magisk ${{ github.event.inputs.MagiskVersion }} \
            --root ${{ github.event.inputs.RootSolution }} \
            --gapps ${{ github.event.inputs.GApps }} \
            --removeamazon ${{ github.event.inputs.RemoveAmazon }} \
            --arch ${{ github.event.inputs.Architecture }} \
            --windows ${{ github.event.inputs.WindowsEdition }}

      - name: Upload result
        uses: actions/upload-artifact@v4
        with:
          name: WSA-${{ github.event.inputs.RootSolution }}-${{ github.run_id }}
          path: output/*.7z
