name: Upload to Gitee Releases (Parallel Auto-Retry)

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘ï¼Œä¹Ÿå¯ä»¥æ”¹æˆ schedule
  workflow_run:
    workflows: ["Build WSA"]  # ğŸ‘ˆ æ”¹æˆä½ æ„å»ºæµç¨‹çš„åå­—
    types:
      - completed

jobs:
  upload:
    name: Upload ${{ matrix.file }} to Gitee
    runs-on: ubuntu-latest
    strategy:
      matrix:
        file:
          - WSA_10_magisk_gapps.7z
          - WSA_10_magisk_none.7z
          - WSA_11_kernelsu_gapps.7z
          - WSA_11_none_gapps.7z
          - WSA_11_magisk_none.7z
          - WSA_11_kernelsu_none.7z
      fail-fast: false

    steps:
      - name: Download build artifacts
        uses: actions/download-artifact@v4
        with:
          name: ${{ matrix.file }}
          path: release

      - name: Upload to Gitee (Auto Retry)
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
          GITEE_REPO: "ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“"  # ğŸ‘ˆ æ”¹è¿™é‡Œ
        run: |
          chmod +x .github/scripts/upload-gitee.sh
          bash .github/scripts/upload-gitee.sh "release/${{ matrix.file }}"
